<!doctype html>
<html class="article">
	
<!-- Mirrored from www.goliatone.com/2011/11/23/as3-keep-your-uis-dry/ by HTTrack Website Copier/3.x [XR&CO'2010], Fri, 13 Apr 2012 14:37:24 GMT -->
<head>
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
		<link rel="stylesheet" type="text/css" href="../../../../css/main.css">
		<link rel="stylesheet" type="text/css" href="../../../../css/style.css">
		
		<link type="text/css" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono&amp;v2">
		<link rel="alternate" type="application/atom+xml" title="AS3: Keep your UI's DRY - feed" href="../../../../index.xml" />
		<script type="text/javascript" src="../../../../../ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.js"></script>
		
		<!-- % if @path.split('/').length > 3 % -->
		<!-- portfolio -->
		<!-- % end %-->
		
		
		
		
		
		<!-- site wide -->
		<script type="text/javascript" src="../../../../js/scrolltopcontrol.js"></script>
		<link type="text/css" rel="stylesheet" href="../../../../plugins/jquery.qtip/jquery.qtip.min.css" media="screen">
		<script type="text/javascript" src="../../../../plugins/jquery.qtip/jquery.qtip.min.js"></script>
		
		<meta name="google-site-verification" content="TWGV929EFuxVYv-EqvoD2Hrc7s6gqOuJbM5j5fe3Agk" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		<meta name="description"
		content="Blog of Goliatone" />
		<title> 
			AS3: Keep your UI's DRY - Goliatone
			 </title>
		<script type="text/javascript">
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-27075690-1']);
		  _gaq.push(['_trackPageview']);
		
		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		
		</script>
	</head>
	<body>
		<div id="preloadBar" style="display:none;height:0px; z-index: 10000;"></div>
		<div id="wrapper">
			<header id="head" class="group" role="banner">
				<div class="logo">
					<a href="../../../../index.html"><img src="http://www.gravatar.com/avatar/b28c54608965139b5dea3f4d9fc46189?s=128&amp;d=identicon&amp;r=PG" alt="Goliatone"></a>
				</div><!--logo-->
				<nav id="main-menu">
					<ul>
						<li  class="active"
							> <a href="../../../../index.html">Notes</a>
						</li>
						<li >
							<a href="../../../../portfolio.html">Portfolio</a>
						</li>
						<li >
							<a href="../../../../about.html">About</a>
						</li>
						<li >
							<a href="../../../../resume.html">Resume</a>
						</li>
						<li >
							<a href="../../../../archives.html">Archive</a>
						</li>
					</ul>
				</nav>
			</header>
			<section class="main" id="article">
				
<div id="article-content">
	<div class="tagline">
		<h1>AS3: Keep your UI's DRY</h1>
		<span>November 23rd 2011</span>
		<div class="post-navigation">
			<a href="../../17/apache-not-booting-on-windows.html" class="prev post-navigation-item" rel="/2011/11/17/apache-not-booting-on-windows #article-content">Previous</a>
			<a href="../../../12/03/kohana-php-cli.html" class="next post-navigation-item" rel="/2011/12/03/kohana-php-cli #article-content">Next</a>
		</div>	
		<div class="clear"></div>
	</div>
	<article class="post first">
		<section class="content">
			
			<div id="article-body">
				<p>Consider the following code snippet. Real world code, a form with multiple icons:</p>

<pre><code>//contactIconBtn
var contactIconBtn:Sprite = _skin.getAssetAs("contactIconBtn", Sprite, null );
_contactIconBtn = new OSIconButton(contactIconBtn);
_contactIconBtn.addEventListener(InteractiveContainer.ON_CLICK, _hanldeButtons );

//whatIsIconBtn =&gt; window_info:
var whatIsIconBtn:Sprite = _skin.getAssetAs("whatIsIconBtn", Sprite, null );
_whatIsIconBtn = new OSIconButton(whatIsIconBtn);
_whatIsIconBtn.addEventListener(InteractiveContainer.ON_CLICK, _hanldeButtons );

//twitterIconBtn
var twitterIconBtn:Sprite = _skin.getAssetAs("twitterIconBtn", Sprite, null );
_twitterIconBtn = new OSIconButton(twitterIconBtn);
_twitterIconBtn.addEventListener(InteractiveContainer.ON_CLICK, _hanldeButtons );

//facebookIconBtn
var facebookIconBtn:Sprite = _skin.getAssetAs("facebookIconBtn", Sprite, null );
_facebookIconBtn = new OSIconButton(facebookIconBtn);
_facebookIconBtn.addEventListener(InteractiveContainer.ON_CLICK, _hanldeButtons );
</code></pre>

<p>Ugly, how to keep it <strong>DRY</strong>? Let&rsquo;s first look at this other snippet, which is the same but refactored.</p>

<pre><code>var icons:Array = _skin.locateChildrenBySuffix(/(^.+)(IconBtn)/i, Sprite, -1);
var btn:OSIconButton;
for each( var skin:Sprite in icons ) {
    btn = new OSIconButton(skin);
    btn.addEventListener(InteractiveContainer.ON_CLICK, _hanldeButtons );
    this["_" + skin.name] = btn;
}
</code></pre>

<p>Much nicer, ain&rsquo;t it!</p>

<p>Now, for this to work we need to have in place some conventions. This is how I handle the buttons. Notice how there is a single method handling all buttons and discriminating by the button&rsquo;s name:</p>

<pre><code>private function _hanldeButtons(e:Event):void {
    switch(e.target.name ) {
        case _contactIconBtn.name:
            _windowManager.openWindow( WindowContact.ID, false );
        break;
        case _whatIsIconBtn.name:
            _windowManager.openWindow( WindowInfo.ID, false );
        break;
        case _facebookIconBtn.name:
            var link:LinkVO = ModelList.instance.siteModel.getLink( "facebookUrl");
            link.execute( );
                break;
        case _twitterIconBtn.name:
            link = ModelList.instance.siteModel.getLink( "twitterUrl");
            link.execute( );
        break;
    }
}
</code></pre>

<p>The important method of <code>_skin:</code></p>

<pre><code>/**
 * @inheritDoc
 */
public function locateChildrenBySuffix(suffix:*, type:Class , index:int = 0 ):* {
    var collection:Array = ContainerUtils.collect( _source, suffix );
    if ( collection.length == 1 ) return collection[0] as type;
    else if ( collection.length &gt; 1 &amp;&amp; index == -1 ) return collection;
    else return collection[index] as type;
}
</code></pre>

<p>The call to <code>ContainerUtils.collect( _source, suffix );</code> handles the actual gathering of items:</p>

<pre><code>/**
 * 
 * @param   container
 * @param   mask
 * @return
 */
public static function collect( container:DisplayObjectContainer, mask:* ):Array {

    var reg:RegExp = mask is RegExp ? mask : new RegExp( mask );

    var n:int = container.numChildren;
    var c:DisplayObject;
    var id:String;
    var childs:Array = [];
    while (n-- &gt; 0 ) {
        c = container.getChildAt(n);
        id = c.name;
        if ( id.match( reg ) ) childs.push( c );
    }

    return childs;
}
</code></pre>

			</div>
		</section>
		<div class="more left">
			<a href="../../../../index.html">Back to Kansas</a>
		</div>
			
		<div id="clear">&nbsp;</div> 
		
	</article>
</div>


<script type="text/javascript">
	// Create the tooltips only on document load
	$(document).ready(function()
	{
		var descLength = 150;
		//Find tooltip settings by direction.
		var tooltipPos = {};
		tooltipPos.prev = {at: 'left center', my: 'right center'};
		tooltipPos.next = {at: 'right center', my: 'left center'};
		
		var positionTooltip = function(cls){
			var dir = (cls.indexOf('next') != -1) ? 'next' : 'prev';
			var position = { viewport: $(window), effect: false};
			position.at = tooltipPos[dir].at;
			position.my = tooltipPos[dir].my;
			console.log(position);
	        return position;
		};
		
		/*
		 * We want somewhat clean content to display on our tooltip.
		 * No code, please :) Save the goods for the real deal.
		 */
		var cleanBodyPreview = function(body){
			var codeTags = ['<pre','<code'];
			for(var tag in codeTags) if(body.indexOf(codeTags[tag]) != -1 ) body = body.split(codeTags[tag])[0];
			body = body.substring(0,descLength) + "...";
			return body;
		};
	   // Make sure to only match links to wikipedia with a rel tag
	   $('a.post-navigation-item:not(.disabled-link)').each(function()
	   {
	      $(this).qtip(
	      {
	         content: {
	            // Set the text to an image HTML string with the correct src URL to the loading image you want to use
	            text: '<img class="throbber" src="/images/project-loader.gif" alt="Loading..." />',
	            ajax: {
	               url: $(this).attr('rel'), // Use the rel attribute of each element for the url to load
	               success: function(data, status) {
			            // Process the data
			 			var $page = $(data);
			 			//$page.find('pre').each(function(){$(this).addClass('prettyprint')});
			 			var title = $page.find('div.tagline h1').html();
			 			var body = $page.find("#article-body").html();
			 			if( body.length > descLength ) body = cleanBodyPreview(body); 
			 			var content =  title + body;
			 			
			            // Set the content manually (required!)
			            this.set('content.text', content);
			         },
	            },
	            
	         },
	         position: positionTooltip($(this).attr('class').split(/\s+/)),
	         show: {
	            event: 'mouseenter',
	            solo: true // Only show one tooltip at a time
	         },
	         hide: 'mouseleave',
	         style: {
	            classes: 'ui-tooltip-wiki ui-tooltip-tipsy ui-tooltip-shadow'
	         }
	      })
	   });
	});
</script>
			</section>
			<footer id="footer">
				<span class="first">&copy; 2011 Goliatone</span><span>Powered by <a href="http://cloudhead.io/toto">toto</a></span>
			</footer>
			 <!-- don't add extra page load on header :) -->
			<link type="text/css" rel="stylesheet" href="../../../../plugins/google-code-prettify/toto-desert.css" />
			<script type="text/javascript" src="../../../../plugins/google-code-prettify/prettify.js"></script>
			<script type="text/javascript">
				$(document).ready(function() {
					// Handler for .ready() called.
					$('pre').addClass('prettyprint');
					prettyPrint();
					$("pre .prettyprint").wrapInner("<span></span>");

					$("pre").hover(function() {
						var contentwidth = $(this).contents().width();
						var blockwidth = $(this).width();
						if(contentwidth > blockwidth) {
							$(this).animate({
								width : "830px"
							}, 250);
						}
					}, function() {
						$(this).animate({
							width : "680px"
						}, 250);
					});
				});

			</script>
			
		</div><!--wrapper-->
	</body>

<!-- Mirrored from www.goliatone.com/2011/11/23/as3-keep-your-uis-dry/ by HTTrack Website Copier/3.x [XR&CO'2010], Fri, 13 Apr 2012 14:37:24 GMT -->
</html>
